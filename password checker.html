<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pro Password Strength Checker</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background: #1e1e2f; /* Darker, professional background */
        color: #e0e0e0;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 20px;
        min-height: 100vh;
    }
    h1 {
        margin-bottom: 10px;
        color: #64ffda; /* Accent color */
    }
    p.subtitle {
        margin-bottom: 30px;
        color: #b0b0b0;
    }
    /* Input Container for Toggle Button */
    .input-group {
        position: relative;
        width: 336px;
        margin-bottom: 15px;
    }
    input[type="password"], input[type="text"].visible {
        padding: 12px 18px;
        font-size: 18px;
        border-radius: 8px;
        border: 2px solid #3a3a5a;
        background: #2a2a44;
        color: #e0e0e0;
        width: 100%; /* Fill container */
        box-sizing: border-box; /* Include padding and border in the element's total width and height */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        padding-right: 45px; /* Make space for the toggle icon */
    }
    input[type="password"]:focus, input[type="text"].visible:focus {
        outline: none;
        border-color: #64ffda;
    }
    /* Password Visibility Toggle Button */
    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #b0b0b0;
        font-size: 18px;
        user-select: none;
        transition: color 0.2s;
    }
    .toggle-password:hover {
        color: #64ffda;
    }

    /* Strength Meter Styling */
    .meter-container {
        width: 336px;
        height: 12px;
        background: #3a3a5a;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 20px;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    #strengthBar {
        height: 100%;
        width: 0%;
        transition: width 0.3s ease-in-out, background-color 0.3s;
    }
    button {
        padding: 12px 30px;
        font-size: 18px;
        border-radius: 8px;
        border: none;
        background-color: #64ffda;
        color: #1e1e2f;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.1s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    button:hover {
        background-color: #4fffbd;
        transform: translateY(-1px);
    }
    #feedback {
        margin-top: 25px;
        font-size: 18px;
        text-align: center;
    }
    .status-text {
        font-weight: bold;
        font-size: 24px;
        margin-bottom: 5px;
    }
    .weak-color { color: #ff6b6b; }
    .moderate-color { color: #ffe66d; }
    .strong-color { color: #4ecdc4; }
    .excellent-color { color: #64ffda; }
</style>
</head>
<body>

<h1>Password Strength Evaluator üîë</h1>
<p class="subtitle">Real-time analysis based on cryptographic entropy.</p>

<div class="input-group">
    <input type="password" id="passwordInput" placeholder="Start typing your password..." onkeyup="checkRealTimeStrength()" autocomplete="off" />
    <span class="toggle-password" onclick="togglePasswordVisibility()">
        <span id="toggleIcon">üëÅÔ∏è</span>
    </span>
</div>

<div class="meter-container">
    <div id="strengthBar"></div>
</div>

<div id="feedback">
    <div class="status-text" id="statusText">Start typing to see the strength.</div>
    <div id="adviceText" style="font-size: 16px; margin-top: 10px;"></div>
</div>

<button onclick="generatePDFReport()">Download Report (Current Check)</button>

<script>
    // Grab jsPDF from the UMD module
    const { jsPDF } = window.jspdf;

    /**
     * Helper function to get the base Character Set Size (R-value).
     * @param {string} password The password to check.
     * @returns {number} The calculated R-value.
     */
    function getRValue(password) {
        let R = 0;
        if (/[a-z]/.test(password)) R += 26; // Lowercase
        if (/[A-Z]/.test(password)) R += 26; // Uppercase
        if (/[0-9]/.test(password)) R += 10; // Numbers
        // Special characters (approximation of common symbols)
        if (/[!@#$%^&*()_+={}\[\]:;"'<,>.?\/\\|~`-]/.test(password)) R += 32;
        return R;
    }

    /**
     * Converts entropy (bits) to a human-readable time-to-crack estimate.
     * Assault speed assumed: 100 billion guesses/second (10^11).
     * @param {number} entropy The entropy score in bits.
     * @returns {string} Human-readable time estimate.
     */
    function getTimeToCrack(entropy) {
        if (entropy < 1) return "Instant";
        const logTimeSeconds = (entropy * Math.log10(2)) - 11;
        const timeSeconds = Math.pow(10, logTimeSeconds);

        if (timeSeconds < 1) return "Milliseconds";
        if (timeSeconds < 60) return `${Math.round(timeSeconds)} seconds`;
        
        const timeMinutes = timeSeconds / 60;
        if (timeMinutes < 60) return `${Math.round(timeMinutes)} minutes`;

        const timeHours = timeMinutes / 60;
        if (timeHours < 24) return `${Math.round(timeHours)} hours`;

        const timeDays = timeHours / 24;
        if (timeDays < 365) return `${Math.round(timeDays)} days`;

        const timeYears = timeDays / 365.25;
        if (timeYears < 1000) return `${timeYears.toFixed(1)} years`;

        const timeCenturies = timeYears / 100;
        return `${timeCenturies.toFixed(0)} centuries`;
    }

    /**
     * Calculates the cryptographic entropy (in bits) of a password, applying penalties.
     * @param {string} password The password to check.
     * @returns {{entropy: number, baseEntropy: number}} Calculated entropy and the entropy before penalties.
     */
    function calculateEntropy(password) {
        const R = getRValue(password);
        
        if (R <= 1 || password.length === 0) return { entropy: 0, baseEntropy: 0 };

        // Base Entropy: H = L * log2(R)
        const L = password.length;
        const baseEntropy = L * (Math.log(R) / Math.log(2));

        // --- Enhanced Penalty Logic ---
        let penalty = 0;
        
        // Penalty 1: Repetitive Characters (e.g., aaaa, 1111)
        if (/(.)\1{3,}/.test(password)) penalty += 10; 
        
        // Penalty 2: Common Sequences (e.g., abc, 123, qwer)
        if (/qwerty|asdfg|123456|654321|abcde|zyxw|tuvwxyz/.test(password.toLowerCase())) penalty += 15;
        
        // Penalty 3: Years/Dates (e.g., 2024, 1990) - simple check
        if (/\b(?:19|20)\d{2}\b/.test(password)) penalty += 8;
        
        return { 
            entropy: Math.max(0, baseEntropy - penalty),
            baseEntropy: baseEntropy 
        };
    }

    /**
     * Determines the strength level based on entropy and provides feedback.
     */
    function getStrengthLevel(entropyData, password) {
        const entropy = entropyData.entropy;
        const baseEntropy = entropyData.baseEntropy;
        const result = { level: 'Weak', color: '#ff6b6b', advice: [] };
        
        // Criteria Checks for Advice
        if (password.length < 12) result.advice.push('Increase the length (12+ is highly recommended).');
        if (!/[A-Z]/.test(password)) result.advice.push('Include at least one uppercase letter.');
        if (!/[a-z]/.test(password)) result.advice.push('Include at least one lowercase letter.');
        if (!/\d/.test(password)) result.advice.push('Include at least one number.');
        if (!/[!@#$%^&*()_+={}\[\]:;"'<,>.?\/\\|~`-]/.test(password)) result.advice.push('Include a special character for diversity.');

        // Define levels based on entropy thresholds
        if (entropy >= 128) {
            result.level = 'Excellent';
            result.color = '#64ffda';
        } else if (entropy >= 90) { 
            result.level = 'Strong';
            result.color = '#4ecdc4';
        } else if (entropy >= 60) {
            result.level = 'Moderate';
            result.color = '#ffe66d';
        } else {
            result.level = 'Weak';
            result.color = '#ff6b6b';
        }
        
        // Add a warning if a pattern penalty was applied
        if (entropy < baseEntropy) {
             result.advice.push('Warning: Avoid common dictionary words or predictable patterns (penalty applied).');
        }

        return result;
    }

    /**
     * Toggles the visibility of the password input field.
     */
    function togglePasswordVisibility() {
        const input = document.getElementById('passwordInput');
        const icon = document.getElementById('toggleIcon');
        
        if (input.type === 'password') {
            input.type = 'text';
            icon.textContent = 'üôà'; // Closed eye icon
            input.classList.add('visible');
        } else {
            input.type = 'password';
            icon.textContent = 'üëÅÔ∏è'; // Open eye icon
            input.classList.remove('visible');
        }
    }

    /**
     * Main function to update UI in real-time.
     */
    function checkRealTimeStrength() {
        const password = document.getElementById('passwordInput').value;
        const statusDiv = document.getElementById('statusText');
        const adviceDiv = document.getElementById('adviceText');
        const strengthBar = document.getElementById('strengthBar');
        
        if (password.length === 0) {
            statusDiv.textContent = 'Start typing to see the strength.';
            statusDiv.className = 'status-text';
            adviceDiv.innerHTML = '';
            strengthBar.style.width = '0%';
            strengthBar.style.backgroundColor = '#3a3a5a';
            return;
        }

        const entropyData = calculateEntropy(password);
        const { level, color, advice } = getStrengthLevel(entropyData, password);
        const crackTime = getTimeToCrack(entropyData.entropy);
        
        // --- 1. Update Strength Bar ---
        const maxEntropyVisual = 100; 
        const percentage = Math.min(100, Math.round(entropyData.entropy / maxEntropyVisual * 100));

        strengthBar.style.width = percentage + '%';
        strengthBar.style.backgroundColor = color;
        
        // --- 2. Update Text Feedback ---
        statusDiv.textContent = `${level} | ${entropyData.entropy.toFixed(2)} bits`;
        statusDiv.className = `status-text ${level.toLowerCase()}-color`;

        if (level === 'Excellent' || level === 'Strong') {
            adviceDiv.innerHTML = `This password should resist a powerful cluster for **${crackTime}**.`;
        } else {
            let adviceHTML = `**Time to Crack:** ${crackTime}. **Suggestions for Improvement:**<br>`;
            adviceHTML += advice.map(a => `‚Äî ${a}`).join('<br>');
            adviceDiv.innerHTML = adviceHTML;
        }
    }

    /**
     * Generates and downloads the PDF report with Time-to-Crack estimate.
     */
    function generatePDFReport() {
        const password = document.getElementById('passwordInput').value;
        if (!password) {
            alert('Please check a password before generating a report!');
            return;
        }
        
        const entropyData = calculateEntropy(password);
        const { level, color, advice } = getStrengthLevel(entropyData, password);
        const crackTime = getTimeToCrack(entropyData.entropy);
        const timestamp = new Date().toLocaleString();
        
        const doc = new jsPDF();
        let yPos = 20;

        doc.setFontSize(24);
        doc.setTextColor(30, 30, 47);
        doc.text('Password Strength Analysis Report', 105, yPos, null, null, 'center');
        yPos += 15;

        doc.setFontSize(10);
        doc.setTextColor(150, 150, 150);
        doc.text(`Generated on: ${timestamp}`, 105, yPos, null, null, 'center');
        yPos += 15;

        // Strength Summary Box
        doc.setDrawColor(200, 200, 200);
        doc.setLineWidth(0.5);
        doc.rect(20, yPos, 170, 40);
        
        doc.setFontSize(14);
        doc.setTextColor(0, 0, 0);
        doc.text('STATUS:', 25, yPos + 10);
        doc.text('ENTROPY (Bits):', 25, yPos + 20);
        doc.text('TIME TO CRACK:', 25, yPos + 30);

        // Apply color based on strength
        const [r, g, b] = hexToRgb(color);
        doc.setTextColor(r, g, b);
        doc.text(level.toUpperCase(), 70, yPos + 10);
        doc.text(entropyData.entropy.toFixed(2), 70, yPos + 20);
        
        doc.setTextColor(0, 0, 0);
        doc.text(crackTime, 70, yPos + 30); 
        yPos += 50;

        // Details and Advice
        doc.setFontSize(16);
        doc.setTextColor(50, 50, 50);
        doc.text('Detailed Feedback', 20, yPos);
        yPos += 10;
        
        if (advice.length > 0) {
            doc.setFontSize(12);
            doc.setTextColor(80, 80, 80);
            doc.text('Suggestions for Improvement:', 20, yPos);
            yPos += 5;
            advice.forEach((item) => {
                yPos += 7;
                doc.text(`\u2022 ${item}`, 25, yPos);
            });
        } else {
            doc.setFontSize(12);
            doc.setTextColor(0, 150, 0); 
            doc.text('Your password meets high security standards. No improvements suggested.', 20, yPos + 7);
        }

        // Final Save
        doc.save(`Password_Report_${new Date().toISOString().slice(0, 10)}.pdf`);
    }

    /** Helper to convert hex color to RGB array for jsPDF */
    function hexToRgb(hex) {
        var bigint = parseInt(hex.slice(1), 16);
        var r = (bigint >> 16) & 255;
        var g = (bigint >> 8) & 255;
        var b = bigint & 255;
        return [r, g, b];
    }
</script>

</body>
</html>